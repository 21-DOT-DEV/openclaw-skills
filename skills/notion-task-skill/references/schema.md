# Notion Task Database Schema

This document defines the exact Notion database properties required for the
notion-task-skill. Your Notion database **must** have these properties with
the specified types and allowed values.

## Required Properties

### Core Task Properties

| Property             | Type      | Description                              |
|----------------------|-----------|------------------------------------------|
| TaskID               | Text      | Unique human-readable task identifier    |
| Status               | Select    | Current task lifecycle state             |
| Priority             | Number    | Numeric priority (higher = more urgent)  |
| ClassOfService       | Select    | Kanban class-of-service category         |
| AcceptanceCriteria   | Rich Text | Definition of done for this task         |
| DependenciesOpenCount| Rollup    | Number type; count of open dependencies  |

### Status — Allowed Select Options

| Value         | Meaning                                    |
|---------------|--------------------------------------------|
| BACKLOG       | Not yet ready for work                     |
| READY         | Ready to be pulled by an agent or human    |
| IN_PROGRESS   | Currently being worked on                  |
| BLOCKED       | Cannot proceed; requires intervention      |
| REVIEW        | Work complete, awaiting review             |
| DONE          | Finished and accepted                      |
| CANCELED      | Abandoned; will not be completed           |

### ClassOfService — Allowed Select Options

| Value        | Rank | Meaning                                    |
|--------------|------|--------------------------------------------|
| EXPEDITE     | 1    | Drop everything; highest urgency           |
| FIXED_DATE   | 2    | Has a hard deadline                        |
| STANDARD     | 3    | Normal priority work                       |
| INTANGIBLE   | 4    | Technical debt, improvements, nice-to-have |

### Locking Properties

These properties implement optimistic locking to prevent multiple agents from
working on the same task simultaneously.

| Property    | Type   | Description                                       |
|-------------|--------|---------------------------------------------------|
| ClaimedBy   | Select | Who holds the lock: `AGENT` or `HUMAN`            |
| AgentRunID  | Text   | Unique identifier for the agent's current run     |
| AgentName   | Text   | Name/identifier of the agent holding the lock     |
| LockToken   | Text   | UUID token for lock verification                  |
| LockedUntil | Date   | ISO 8601 timestamp when the lock expires          |

### ClaimedBy — Allowed Select Options

| Value  | Meaning                           |
|--------|-----------------------------------|
| AGENT  | Claimed by an automated agent     |
| HUMAN  | Claimed by a human operator       |

## Recommended (Optional) Properties

These properties are not required but improve observability and auditability.

| Property            | Type      | Description                                    |
|---------------------|-----------|------------------------------------------------|
| Artifacts           | Rich Text | Links/references to work products              |
| BlockerReason       | Text      | Why the task is blocked                        |
| UnblockAction       | Text      | What needs to happen to unblock                |
| NextCheckAt         | Date      | When to re-check a blocked task                |
| StartedAt           | Date      | When work began (set on claim)                 |
| DoneAt              | Date      | When work completed (set on complete)          |
| ClassOfServiceRank  | Number    | Explicit sort rank (1=EXPEDITE, 2=FIXED_DATE, 3=STANDARD, 4=INTANGIBLE). If present, used instead of deriving rank from the Select value. |

## Notes

- **DependenciesOpenCount** must be a Rollup property that counts related
  tasks whose Status is not DONE or CANCELED. A task is only READY when this
  value equals 0.
- **LockToken** is a UUID v4 generated by ntask at claim time. It must be
  presented for heartbeat, complete, and block operations to verify ownership.
- **LockedUntil** uses ISO 8601 format (e.g., `2025-01-15T14:30:00Z`).
  A lock is considered expired when the current time exceeds this value.
- **Future enhancement:** Property name overrides via environment variables
  (e.g., `NTASK_PROP_STATUS=MyStatus`) to support existing databases without
  renaming properties. Not yet implemented in v0.1.0.
